{% extends "survey/survey_dashboard.html" %}
{% load static from staticfiles %}

{% block css %}
    {{ block.super }}
    <link rel="stylesheet" href='{% static "css/results.css" %}'/>
{% endblock %}

{% block javascript %}
{{ block.super }}
<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script type="text/javascript" src='{% static "js/results.js" %}'></script>
{% endblock %}


{% block content %}
  <a href='{% url exportresults survey.slug %}'>Export Report to Excel</a>
  <label class = "foot_note">Note: Click on a question field to filter results.</label>
  {% regroup choices by question as question_list %}
    {% for question in question_list %}      
        <div class='results left'>
      {% if question.grouper.type == 'TB' or question.grouper.type == 'TA' %}
        <label id = "{{ survey.slug }}_{{ question.grouper.order_number }}" class = "accordion field_title_accordion">{{ question.grouper }}</label>
        <ul>
      {% else %} 
        <div class='left result'>
        <label class = "field_title">{{ question.grouper }}</label>
        <table>
      {% endif %}

      {% for choice in question.list %}
        {% if choice.question.type == 'TB' or choice.question.type == 'TA' %}
          <li><a href="{% url ballot survey.slug choice.get_first_answer.ballot.pk %}">{{ choice.message }}</a></li>
        {% else %}             
          <tr>
            <td {% if choice_id == choice.id %} class="field_sorted_by"{% endif %}>
              <a href="{% url surveyresults survey.slug choice.pk %}">{{ choice.message }}:</a>
            </td>
            <td>{% firstof choice.num_answers '0' %}</td>
          </tr>
        {% endif %}
      {% endfor %}

      {% if question.grouper.type == 'TB' or question.grouper.type == 'TA' %}
        </ul>
      {% else %}             
        </table>
        </div>
        <div class='piegraph left' id='id_{{ question.grouper.pk }}'></div>
      {% endif %}
        </div>
    {% endfor %}
{% endblock %}
