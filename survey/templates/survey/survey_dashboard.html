{% extends "survey/base.html" %}
{% load static from staticfiles %}

{% block css %}
{{ block.super }}
<link type='text/css' rel='stylesheet' href='{% static "css/jquery-ui-timepicker-addon.css" %}' />
<link type='text/css' rel='stylesheet' href='{% static "css/results.css" %}' />
{% endblock %}

{% block javascript %}
{{ block.super }}
<script type='text/javascript' src='{% static "js/jquery.slider-access.js" %}'></script>
<script type='text/javascript' src='{% static "js/jquery.timepicker-add-on.min.js" %}'></script>
<script type='text/javascript' src='{% static "js/survey_dashboard.js" %}'></script>
{% endblock %}

{% block content %}

<div id='survey-title'>
    <h1>
        {{ survey.title }}
        <ul class='buttons'>
              <li><a href='{% url index %}'>Home</a></li>
              <li><a href='{% url survey survey.slug %}'>View</a>
            {% if not survey.is_active and not survey.closed %}
              <li><a href='{% url editsurvey survey.slug %}'>Edit</a></li>
              <li><a href='{% url publishsurvey survey.slug %}'>Publish</a></li>
            {% elif not survey.closed %}
              <li><a href='{% url closesurvey survey.slug %}'>Close</a></li>
            {% endif %}
        </ul>
    </h1>
</div>

<div class='future-wrapper'>
    {% if survey.start_date and not survey.is_active and not survey.closed %}
      <h2 class='button-header'>Future Publish Date <ul class='buttons'><li><a class='edit-handler' href='#'>Edit</a></li></ul></h2>
      <p>Will be published on {{ survey.start_date }}</p>
    {% elif not survey.is_active and not survey.closed %}
      <h2>Set Future Publish Date</h2>
      <form method='post' action=''>
        {% csrf_token %}
          Future Date: <input type='text' name='future_publish_date' />
          <input type='submit' name='save_publish_date' value='Save Publish Date' />
      </form>
    {% else %}
      <h2>Publish Date</h2>
      {{ survey.start_date }}
    {% endif %}
    <form method='post' action='' class='hidden-form'>
      {% csrf_token %}
      Future Date: <input type='text' name='future_publish_date' />
      <input type='submit' name='save_publish_date' value='Save Publish Date' />
    </form>
</div>

<div class='future-wrapper'>
  {% if survey.end_date and not survey.closed %}
      <h2 class='button-header'>Future Close Date <ul class='buttons'><li><a class='edit-handler' href='#'>Edit</a></li></ul></h2>
      <p>Will be published on {{ survey.end_date }}</p>
    {% elif not survey.closed %}
      <h2>Set Future Close Date</h2>
      <form method='post' action=''>
        {% csrf_token %}
          Future Date: <input type='text' name='future_close_date' />
          <input type='submit' name='save_end_date' value='Save Close Date' />
      </form>
    {% else %}
      <h2>Close Date</h2>
      {{ survey.end_date }}
    {% endif %}
    <form method='post' action='' class='hidden-form'>
      {% csrf_token %}
      Future Date: <input type='text' name='future_close_date' />
      <input type='submit' name='save_close_date' value='Save Close Date' />
    </form>
</div>

<div>
    <h2>Results</h2>
    {% for question in survey.question_set.all %}
      <h3>{{ question }} - {{ question.get_type_display.title }}</h3>
      
      {% if question.type == 'TB' or question.type == 'TA' %}
        <ul>
          {% for choice in question.choice_set.all %}
            {% for answer in choice.answer_set.all %}
              <li>{{ answer|linebreaksbr }}</li>
            {% endfor %}
          {% endfor %}
        </ul>
      {% endif %}
      
      {% if question.type = 'RA' or question.type = 'CH' or question.type = 'DD' %}
        <table>
          {% for choice in question.choice_set.all %}
            <tr>
              <td>{{ choice }}</td>
              <td>{{ choice.answer_set.count }}</td>
            </tr>
          {% endfor %}
        </table>
      {% endif %}
    {% endfor %}
</div>

<a href="{% url qrcode survey.slug %}">Download QR Code</a>

{% endblock %}